[
  {
    "objectID": "introduccion.html",
    "href": "introduccion.html",
    "title": "1  Introducción",
    "section": "",
    "text": "Carga de paquetes:\n\nlibrary(tidyverse)\nlibrary(arm)\nlibrary(readr)\n\nEjemplo de datos con medidas repetidas:\nConjunto de datos longitudinal de unos 2000 adolescentes australianos cuyos patrones de consumo de tabaco se registraron cada seis meses (a través de un cuestionario) durante un período de tres años.\nCarga de datos:\n\nsmoking &lt;- read_delim('./data/ARM_Data/smoking/smoke_pub.dat') \n\nRows: 8730 Columns: 5\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \"\\t\"\ndbl (5): newid, sex(1=F), parsmk, wave, smkreg\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nsmoking &lt;- smoking %&gt;% rename(sex = `sex(1=F)`) %&gt;%\n  mutate(sex = factor(sex))\n\nY graficamos la prevalencia en del fumado en cada una de las aplicaciones del cuestionario (wave) para cada uno de los sexos:\n\nprevalencia &lt;- smoking %&gt;%\n  group_by(sex,wave) %&gt;%\n  summarise(prevalencia = mean(smkreg)) \n\n`summarise()` has grouped output by 'sex'. You can override using the `.groups`\nargument.\n\nggplot()+geom_line(data=prevalencia,aes(x=wave,y=prevalencia,color = sex)\n                  )+theme_minimal()+labs(title = 'Prevalencia de fumado por sexo',\n                                          x = 'Aplicación del cuestionario',\n                                          y = 'Prevalencia de fumado')\n\n\n\n\n\n\n\n\nTambién podemos separar la información propia del nivel 1 (waves) y los de nivel más agrupado o nivel 2 (individuos):\n\nsmoking_ind &lt;- smoking %&gt;% \n  dplyr::select(wave,newid,smkreg) %&gt;%\n  arrange(wave,newid)\n\nhead(smoking_ind)\n\n# A tibble: 6 × 3\n   wave newid smkreg\n  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;\n1     1     1      0\n2     1     2      0\n3     1     3      0\n4     1     4      0\n5     1     5      0\n6     1     6      0\n\n\n\nsmoking_group &lt;- smoking %&gt;% \n  dplyr::select(newid,sex,parsmk) %&gt;%\n  distinct()\n\nhead(smoking_group)\n\n# A tibble: 6 × 3\n  newid sex   parsmk\n  &lt;dbl&gt; &lt;fct&gt;  &lt;dbl&gt;\n1     1 1          0\n2     2 0          0\n3     3 1          0\n4     4 1          0\n5     5 0          0\n6     6 0          0",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introducción</span>"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Modelos Mixtos",
    "section": "",
    "text": "Prefacio\nNotas computacionales de clase para el curso SP1653, Modelos Mixtos.",
    "crumbs": [
      "Prefacio"
    ]
  },
  {
    "objectID": "MLMbasicos.html",
    "href": "MLMbasicos.html",
    "title": "2  Modelos Lineales Multinivel básicos",
    "section": "",
    "text": "2.1 Pooling completo vs no-pooling\nCarga de datos de radon y depuración:\nradon &lt;- read_delim('./data/ARM_Data/radon/srrs2.dat')\n\nRows: 12777 Columns: 25\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (19):  state,  state2,  stfips,  zip,  region,  basement,  windoor,  rep...\ndbl  (6): idnum,  typebldg,  floor,  room,  dupflag,  zipflag\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nradon &lt;- radon %&gt;% \n  mutate(log_radon = log(as.numeric(` activity`)+0.01),\n         county = as.factor(str_trim(` county`)),\n         state = as.factor(` state`),floor = ` floor`)\nFiltrado a datos de Minnesota:\nradon_city_Minnesota &lt;- radon %&gt;% \n  filter(state == \"MN\")\nBoxplot de los niveles de radon por ciudad:\nmean_radon &lt;- mean(radon_city_Minnesota$log_radon, na.rm = TRUE)\n\nggplot(radon_city_Minnesota, aes(x = county, y = log_radon)) +\n  geom_boxplot() +\n  geom_abline(intercept = mean_radon, slope = 0, color = \"red\") +\n  labs(title = \"Boxplot of Log Radon Levels by City\",\n       x = \"City\",\n       y = \"Log Radon Level\") +\n  theme_minimal()\nBoxplot de los niveles de radon por ciudad ordenados por tamaño de muestra:\ntabla_ns &lt;- radon_city_Minnesota %&gt;% group_by(county) %&gt;% summarise(n = n())  \n\nradon_city_Minnesota &lt;- radon_city_Minnesota %&gt;% \n  left_join(tabla_ns, by = \"county\")\n\n\nradon_city_Minnesota &lt;- radon_city_Minnesota %&gt;%\n  mutate(county = factor(county, levels = tabla_ns$county[order(tabla_ns$n)]))\n\nggplot(radon_city_Minnesota, aes(x = county, y = log_radon)) +\n  geom_boxplot() +\n  geom_abline(intercept = mean_radon, slope = 0, color = \"red\") +\n  labs(title = \"Boxplot of Log Radon Levels by County (Sorted by Sample Size)\",\n       x = \"City\",\n       y = \"Log Radon Level\") +\n  theme_minimal()\nBoxplot de los niveles de radon por ciudad usando partial-pooling (Multinivel):\nlmer_radon &lt;- lmer(log_radon ~ 1 + (1|county), data = radon_city_Minnesota)\n\nradon_city_Minnesota &lt;- radon_city_Minnesota %&gt;% \n  mutate(log_radon_pred = predict(lmer_radon))\n\nggplot(radon_city_Minnesota, aes(x = county, y = log_radon_pred)) +\n  geom_boxplot() +\n  geom_abline(intercept = mean_radon, slope = 0, color = \"red\") +\n  labs(title = \"Boxplot of Log Radon Levels by City (Predicted)\",\n       x = \"City\",\n       y = \"Log Radon Level (Predicted)\") +\n  theme_minimal()\nPooling completo vs no-pooling con una covariable:\nmuestra_counties &lt;- c('LAC QUI PARLE', 'AITKIN','KOOCHICHING',\n                      'DOUGLAS','CLAY','STEARNS','RAMSEY','ST LOUIS')\n\nradon_city_Minnesota_m &lt;- radon_city_Minnesota %&gt;% mutate(county_s = as.character(county)) %&gt;%\n  filter(county_s %in% muestra_counties)\n\n\nregresion_pooling &lt;- lm(log_radon ~ floor, data = radon_city_Minnesota)\nregresion_no_pooling &lt;- lm(log_radon ~ -1+floor+county, data = radon_city_Minnesota_m)\n\n\ncoef_df &lt;- coef(regresion_no_pooling)\n\ncoef_data &lt;- data.frame(\n  county_s = sub(\"county\", \"\", names(coef_df)[grep(\"county\", names(coef_df))]),\n  slope = coef_df[grep(\"floor\", names(coef_df))],\n  intercept = coef_df[grep(\"county\", names(coef_df))]\n)\n\nWarning in data.frame(county_s = sub(\"county\", \"\",\nnames(coef_df)[grep(\"county\", : row names were found from a short variable and\nhave been discarded\n\nradon_city_Minnesota_m &lt;- radon_city_Minnesota_m %&gt;%\n  left_join(coef_data, by = \"county_s\")\n\nggplot(data = radon_city_Minnesota_m) +\n  geom_point(aes(x = floor, y = log_radon)) +\n  geom_abline(aes(intercept = intercept, slope = slope), color = \"blue\") +  # Specific regression lines for each county\n  geom_abline(intercept = coef(regresion_pooling)[1], slope = coef(regresion_pooling)[2], color = \"red\") +  # General regression line\n  facet_wrap(~county_s) +\n  labs(title = \"Radon Levels by Floor with Specific and General Regression Lines\",\n       x = \"Floor\",\n       y = \"Log Radon Level\") +\n  theme_minimal()\nPooling parcial con una covariable (Multinivel):\nlmer_radon_floor &lt;- lmer(log_radon ~ floor + (1|county), \n                         data = radon_city_Minnesota_m)\n\n\nfixed_effect &lt;- fixef(lmer_radon_floor)\nrandom_effects &lt;- ranef(lmer_radon_floor)$county\n\n\ncoef_data_lmer &lt;- data.frame(\n  county_s = rownames(random_effects),\n  intercept_lmer = fixed_effect[1] + random_effects[, 1], \n  slope_lmer = fixed_effect[2]  \n)\n\nWarning in data.frame(county_s = rownames(random_effects), intercept_lmer =\nfixed_effect[1] + : row names were found from a short variable and have been\ndiscarded\n\nradon_city_Minnesota_m &lt;- radon_city_Minnesota_m %&gt;%\n  left_join(coef_data_lmer, by = \"county_s\")\n\nggplot(data = radon_city_Minnesota_m) +\n  geom_point(aes(x = floor, y = log_radon)) +\n  geom_abline(aes(intercept = intercept_lmer, slope = slope_lmer), color = \"blue\") +  # Specific regression lines for each county\n  geom_abline(intercept = fixed_effect[1], slope = fixed_effect[2], color = \"red\") +  # General regression line (fixed effects only)\n  facet_wrap(~county_s) +\n  labs(title = \"Radon Levels by Floor with Specific and General Regression Lines\",\n       x = \"Floor\",\n       y = \"Log Radon Level\") +\n  theme_minimal()",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Modelos Lineales Multinivel básicos</span>"
    ]
  }
]